const userID=jQuery("#account-link a").data("usercode");var pagePath=window.location.pathname;if(pagePath.slice(pagePath.length-1)!="/"){pagePath=pagePath+"/"}function blockFunctions(t,e){let a=jQuery("#block-"+t);let n=a.parent(".wmg-block");if(n.attr("data-options")){let t=n.attr("data-options");t=JSON.parse(t.replace(/'/g,'"'));blockOptionsClasses(n,t)}blockEdit(n);blockImageFix(n);blockShortcodes(n);if(jQuery.inArray("blockBG",e)!==-1){blockBG(n)}}function blockShortcodes(t){let e=10;let a=1;let n="";let l=jQuery(".block__content",t);let r=l.html();while(r.indexOf("[!")>=0&&a<=e){let t=r.substring(r.lastIndexOf("[!")+2,r.lastIndexOf("]"));let e=t.split(/\s+(?=(?:[^\'"]*[\'"][^\'"]*[\'"])*[^\'"]*$)/);let n={};n.type=e[0];jQuery.each(e,(function(t,e){if(t>0){let t=e.split("=");let a=t[1].substring(1,t[1].length-1);n[t[0]]=a}}));switch(n.type){case"button":scOutput='<a href="'+n.link+'" class="btn btn--'+n.style+'">'+n.text+"</a>";break;case"triangle":scOutput='<span class="brand-triangle brand-triangle--'+n.colour+'"><svg width="14" height="19" viewBox="0 0 14 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 19L-1.90735e-06 19L-2.46316e-07 6.83429e-07L14 19Z" fill="#EE3124"/></svg></span>';break}r=r.replace("<p>[!"+t+"]</p>",scOutput);r=r.replace("[!"+t+"]",scOutput);l.html(r);a=a+1}}function blockEdit(t){if(userID!=""){let e=t.data("content_url");jQuery.get("https://sitebuilder.warwick.ac.uk/sitebuilder2/api/permissions.htm?page="+e+"&user="+userID,(function(a){if(a==="true"){jQuery(".block ",t).prepend('<a href="'+e+'" class="block__edit" target="_blank">Edit</a>')}}))}}function blockOptionsClasses(t,e){for(const[a,n]of Object.entries(e)){jQuery(".block",t).addClass(a+"--"+n)}}function blockImageFix(t){jQuery("img",t).each((function(){var e=jQuery(this).attr("src");if(!e.startsWith("/")){e=t.data("content_url")+e;jQuery(this).attr("src",e)}}))}function blockBG(t){let e=jQuery(".block__content",t);let a=jQuery("img:first-child",e);let n=a.attr("src");jQuery(".block ",t).prepend('<div class="block__bg" style="background-image: url('+n+');"></div>');a.remove()}jQuery(document).ready((function(t){var e=1;t(".wmg-block").each((function(){var a=t(this);var n=a.data("block_id");var l=0;var r=a.data("content_url");var s=a.data("content_url");var o=WMG.blocks[n];var c={};if(!r.startsWith("/")){if(pagePath)r=pagePath+r}if(!r.endsWith("/")){r=r+"/"}t(this).data("content_url",r);if(a.data("content_id")){var l=parseInt(a.data("content_id"))}t.ajax({async:false,url:"https://sitebuilder.warwick.ac.uk/sitebuilder2/api/dataentry/entries.json?page="+r,type:"GET",dataType:"json",success:function(t){var l=t.items;var r={content:t.items,blockCount:e,options:s};a.html(o(r));console.log("#block-"+e+" built as "+n)},error:function(t){console.log("Could not get data from "+r)}});e=e+1}))}));